---
phase: 02-verification-automation-and-reporting
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/run_tests.sh
  - .github/workflows/ci.yml
  - tests/fixtures/manifest.yaml
autonomous: true
requirements:
  - TEST-03
must_haves:
    truths:
      - CI runs explicit bad-byte profile checks through `verify_denulled.py` on representative fixtures.
      - Profile coverage is explicit and auditable per architecture.
      - Missing representative fixtures fail deterministically with fixture context.
    artifacts:
      - path: tests/run_tests.sh
        provides: Profile-aware bad-byte verification mode with deterministic fixture selection
      - path: .github/workflows/ci.yml
        provides: CI architecture jobs invoking profile-aware bad-byte checks
      - path: tests/fixtures/manifest.yaml
        provides: Representative fixture metadata used by verification selection
    key_links:
      - from: .github/workflows/ci.yml
        to: tests/run_tests.sh
        via: CI forwards architecture and profile-set parameters to verification mode
        pattern: --mode verify-denulled --arch
      - from: tests/run_tests.sh
        to: tests/fixtures/manifest.yaml
        via: runner derives deterministic representative fixture list from tracked metadata
        pattern: manifest.yaml
      - from: tests/run_tests.sh
        to: verify_denulled.py
        via: runner invokes bad-byte verification by configured profile
        pattern: verify_denulled.py --profile
---

<objective>
Integrate explicit profile-aware bad-byte verification into CI architecture jobs using deterministic representative fixture selection.

Purpose: satisfy TEST-03 with auditable profile coverage and reproducible failures.
Output: runner support for verification profile sets + CI wiring for per-arch profile checks.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-verification-automation-and-reporting/02-CONTEXT.md
@.planning/phases/02-verification-automation-and-reporting/02-RESEARCH.md
@tests/run_tests.sh
@tests/fixtures/manifest.yaml
@.github/workflows/ci.yml
@verify_denulled.py

Locked decisions to honor:
- explicit profiles: `null-only` + `http-newline`
- `null-only` on `x86,x64,arm`; `http-newline` on `x86,x64`
- deterministic representative fixture subset from tracked metadata
- fail with fixture ID/path context when selected fixture is missing/invalid
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deterministic representative fixture selection and profile mapping to runner</name>
  <files>tests/run_tests.sh
tests/fixtures/manifest.yaml</files>
  <action>Extend `tests/run_tests.sh` with a `verify-denulled` execution mode that reads representative fixture metadata from `tests/fixtures/manifest.yaml`, resolves architecture-scoped fixture lists in stable order, and executes `verify_denulled.py --profile <profile>` using explicit profile mapping. If any selected fixture is missing or unreadable, fail with fixture identifier and path details.</action>
  <verify><automated>bash -n tests/run_tests.sh && rg -n "verify-denulled|manifest.yaml|--profile|null-only|http-newline|fixture_id" tests/run_tests.sh tests/fixtures/manifest.yaml</automated></verify>
  <done>Runner deterministically selects representative fixtures and executes explicit profile checks with strict fixture validation behavior.</done>
</task>

<task type="auto">
  <name>Task 2: Wire CI architecture jobs to bad-byte profile verification mode</name>
  <files>.github/workflows/ci.yml</files>
  <action>Update CI architecture jobs to invoke the new profile-aware bad-byte verification mode after baseline build/smoke checks. Ensure architecture-to-profile mapping is explicit: `x86/x64` run `null-only,http-newline`; `arm` runs `null-only` in this phase.</action>
  <verify><automated>rg -n "verify-denulled|null-only|http-newline|matrix\.arch|run_tests\.sh" .github/workflows/ci.yml</automated></verify>
  <done>CI consistently enforces configured bad-byte profile checks per architecture with no implicit defaults.</done>
</task>

<task type="auto">
  <name>Task 3: Emit profile-aware pass/fail evidence for downstream reporting</name>
  <files>tests/run_tests.sh
.github/workflows/ci.yml</files>
  <action>Ensure bad-byte verification mode writes machine-readable pass/fail results (profile + fixture + architecture) and raw logs that downstream steps can aggregate. CI must upload resulting evidence artifacts even on failures.</action>
  <verify><automated>rg -n "upload-artifact|if: always\(\)|profile|summary|json|verify-denulled" .github/workflows/ci.yml tests/run_tests.sh</automated></verify>
  <done>Bad-byte verification outputs are preserved and structured for later aggregate reporting checks.</done>
</task>

</tasks>

<verification>
Confirm CI and runner now execute explicit profile verification for representative fixtures, and output artifacts preserve profile-aware evidence.
</verification>

<success_criteria>
- Runner has deterministic representative fixture selection for bad-byte verification
- CI invokes explicit profile sets per architecture
- `verify_denulled.py` profile checks are integrated into CI gate flow
- Profile-level pass/fail evidence is artifacted for each architecture
</success_criteria>

<output>
After completion, create `.planning/phases/02-verification-automation-and-reporting/02-01-SUMMARY.md`
</output>
