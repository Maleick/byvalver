---
phase: 02-verification-automation-and-reporting
plan: "02"
type: execute
wave: 2
depends_on:
  - "01"
files_modified:
  - tests/run_tests.sh
  - .github/workflows/ci.yml
autonomous: true
requirements:
  - TEST-04
must_haves:
    truths:
      - CI executes functionality and semantic verification across deterministic representative fixtures.
      - Verification ordering and fixture selection are stable and reproducible between runs.
      - Failures clearly identify architecture, fixture, and check type.
    artifacts:
      - path: tests/run_tests.sh
        provides: Deterministic functionality and semantic verification orchestration
      - path: .github/workflows/ci.yml
        provides: CI wiring for functionality and semantic checks per architecture
    key_links:
      - from: tests/run_tests.sh
        to: verify_functionality.py
        via: runner invokes functionality verification for each selected fixture
        pattern: verify_functionality.py
      - from: tests/run_tests.sh
        to: verify_semantic.py
        via: runner invokes semantic verification for each selected fixture
        pattern: verify_semantic.py
      - from: .github/workflows/ci.yml
        to: tests/run_tests.sh
        via: CI executes functionality+semantic verification mode by architecture
        pattern: --mode verify-equivalence --arch
---

<objective>
Integrate deterministic functionality and semantic verification into CI architecture jobs using the same representative fixture contract.

Purpose: satisfy TEST-04 with reproducible check behavior and actionable failure context.
Output: runner equivalence-verification mode and CI invocation across architecture matrix jobs.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-verification-automation-and-reporting/02-CONTEXT.md
@.planning/phases/02-verification-automation-and-reporting/02-RESEARCH.md
@.planning/phases/02-verification-automation-and-reporting/02-01-PLAN.md
@tests/run_tests.sh
@.github/workflows/ci.yml
@verify_functionality.py
@verify_semantic.py

Plan dependency:
- Reuse deterministic representative fixture mapping from 02-01
- Preserve architecture fail-late visibility from existing CI matrix
- Keep local and CI verification behavior aligned via runner modes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add equivalence verification mode to runner</name>
  <files>tests/run_tests.sh</files>
  <action>Add a `verify-equivalence` mode to `tests/run_tests.sh` that executes `verify_functionality.py` and `verify_semantic.py` for each deterministic representative fixture per architecture. Ensure consistent ordering, explicit per-check status capture, and non-ambiguous failure messages that include architecture + fixture path.</action>
  <verify><automated>bash -n tests/run_tests.sh && rg -n "verify-equivalence|verify_functionality.py|verify_semantic.py|fixture|arch" tests/run_tests.sh</automated></verify>
  <done>Runner can execute functionality and semantic checks deterministically with architecture/fixture-scoped diagnostics.</done>
</task>

<task type="auto">
  <name>Task 2: Wire CI jobs to equivalence verification mode</name>
  <files>.github/workflows/ci.yml</files>
  <action>Update CI architecture job flow to run `verify-equivalence` mode after profile verification. Keep fail-late behavior and ensure both functionality and semantic checks are included in architecture-level gate behavior.</action>
  <verify><automated>rg -n "verify-equivalence|verify_functionality|verify_semantic|matrix\.arch|if: always\(\)" .github/workflows/ci.yml</automated></verify>
  <done>CI executes deterministic functionality and semantic verification for each architecture in the same run surface.</done>
</task>

<task type="auto">
  <name>Task 3: Normalize equivalence check output for report generation</name>
  <files>tests/run_tests.sh
.github/workflows/ci.yml</files>
  <action>Emit machine-readable and raw log outputs for functionality and semantic checks with stable naming so downstream reporting can merge results reliably. Include clear check identifiers to distinguish functionality vs semantic failures.</action>
  <verify><automated>rg -n "functionality|semantic|summary|json|log|artifact" tests/run_tests.sh .github/workflows/ci.yml</automated></verify>
  <done>Equivalence verification results are structured for automated report aggregation and post-failure debugging.</done>
</task>

</tasks>

<verification>
Validate that functionality and semantic verifiers are integrated through runner mode and CI architecture invocation with deterministic fixture selection.
</verification>

<success_criteria>
- Runner supports deterministic functionality and semantic verification mode
- CI invokes equivalence verification per architecture
- Failure output includes architecture + fixture + check type
- Structured outputs exist for later aggregate report generation
</success_criteria>

<output>
After completion, create `.planning/phases/02-verification-automation-and-reporting/02-02-SUMMARY.md`
</output>
