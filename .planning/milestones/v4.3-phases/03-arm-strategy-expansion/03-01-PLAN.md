---
phase: 03-arm-strategy-expansion
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/arm_strategies.c
  - src/arm_immediate_encoding.c
  - src/arm_immediate_encoding.h
  - assets/tests/test_arm_strategies.c
  - tests/fixtures/manifest.yaml
autonomous: true
requirements:
  - ARM-01
must_haves:
    truths:
      - ADD/SUB immediate rewrites provide bad-byte-safe alternatives for covered operand patterns.
      - Rewrites preserve arithmetic semantics and decline safely for unsupported cases.
      - Deterministic ARM regression fixtures exist for immediate split paths.
    artifacts:
      - path: src/arm_strategies.c
        provides: ARM ADD/SUB immediate split strategy registration and generation logic
      - path: src/arm_immediate_encoding.c
        provides: Immediate split candidate helpers used by ARM arithmetic strategies
      - path: tests/fixtures/manifest.yaml
        provides: Deterministic ARM fixture metadata for arithmetic split regressions
    key_links:
      - from: src/arm_strategies.c
        to: src/arm_immediate_encoding.c
        via: Arithmetic strategy eligibility and generation call split-immediate helper APIs
        pattern: arm_add_
      - from: assets/tests/test_arm_strategies.c
        to: src/arm_strategies.c
        via: Strategy tests validate arithmetic split rewrite behavior
        pattern: add_sub
      - from: tests/fixtures/manifest.yaml
        to: tests/run_tests.sh
        via: Deterministic ARM fixture IDs feed verification runner selection
        pattern: fixture_id
---

<objective>
Implement ARM ADD/SUB immediate splitting rewrite paths with semantic-safety-first behavior and deterministic regression coverage.

Purpose: satisfy ARM-01 by expanding arithmetic rewrite success while preserving instruction behavior.
Output: helper-backed arithmetic split strategies, tests, and manifest-tracked fixtures.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-arm-strategy-expansion/03-CONTEXT.md
@.planning/phases/03-arm-strategy-expansion/03-RESEARCH.md
@src/arm_strategies.c
@src/arm_immediate_encoding.c
@src/arm_immediate_encoding.h
@assets/tests/test_arm_strategies.c
@tests/fixtures/manifest.yaml

Locked decisions to honor:
- Restrict coverage to Phase 3 scope only.
- Semantic safety first; unsupported patterns must decline rewrite.
- Add deterministic ARM fixtures for arithmetic split regressions.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bounded immediate split helper coverage for ARM arithmetic rewrites</name>
  <files>src/arm_immediate_encoding.c
src/arm_immediate_encoding.h</files>
  <action>Add helper APIs to derive and validate bounded immediate split candidates for ADD/SUB rewrites under active bad-byte profiles. Include explicit failure signaling for unsupported candidate generation.</action>
  <verify><automated>rg -n "split|immediate|arm|encodable|bad byte|bad_byte" src/arm_immediate_encoding.c src/arm_immediate_encoding.h</automated></verify>
  <done>Immediate split helper primitives are available for arithmetic strategy gating and code generation.</done>
</task>

<task type="auto">
  <name>Task 2: Implement ADD/SUB split rewrite strategies with safe fallback behavior</name>
  <files>src/arm_strategies.c</files>
  <action>Implement and register ADD/SUB immediate split rewrite strategies for covered operand forms. Preserve arithmetic semantics and ensure unsupported or unsafe cases explicitly decline rewrite without mutating behavior.</action>
  <verify><automated>rg -n "arm_add|arm_sub|split|register_arm_arithmetic_strategies|can_handle" src/arm_strategies.c</automated></verify>
  <done>ARM arithmetic strategy set supports immediate split rewrites for covered patterns and safe decline for others.</done>
</task>

<task type="auto">
  <name>Task 3: Add deterministic arithmetic regression fixtures and strategy tests</name>
  <files>assets/tests/test_arm_strategies.c
tests/fixtures/manifest.yaml</files>
  <action>Add and register deterministic ARM fixtures that exercise arithmetic split rewrites, and extend ARM strategy tests to validate both rewrite eligibility and generated output expectations for covered patterns.</action>
  <verify><automated>rg -n "fixture_id|arm|add|sub|split" tests/fixtures/manifest.yaml assets/tests/test_arm_strategies.c</automated></verify>
  <done>Arithmetic split behavior is covered by deterministic fixtures and focused ARM strategy regression checks.</done>
</task>

</tasks>

<verification>
Validate that ARM ADD/SUB immediate split rewrites trigger for covered bad-byte cases, preserve arithmetic behavior, and remain deterministic in fixture-driven verification.
</verification>

<success_criteria>
- Helper-backed immediate split logic exists for arithmetic rewrite decisions
- ADD/SUB split strategies are registered with semantic-safe fallback behavior
- Deterministic ARM arithmetic fixtures are added and tracked in manifest metadata
- ARM-01 is demonstrably covered by plan outputs and verification hooks
</success_criteria>

<output>
After completion, create `.planning/phases/03-arm-strategy-expansion/03-01-SUMMARY.md`
</output>
