---
phase: 05-reproducible-release-gate
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/run_tests.sh
  - Dockerfile
  - docker-compose.yml
  - docs/BUILD.md
  - tests/README.md
autonomous: true
requirements:
  - REL-01
must_haves:
    truths:
      - Host and Docker runs produce matching required verification outcomes for representative fixtures.
      - Reproducibility evidence is deterministic and architecture-scoped so parity mismatches are diagnosable.
      - Maintainers can run one documented parity path end to end without ad hoc steps.
    artifacts:
      - path: tests/run_tests.sh
        provides: Deterministic host-vs-Docker parity harness for required verification checks
      - path: Dockerfile
        provides: Reproducible container build environment used by parity execution
      - path: docker-compose.yml
        provides: Stable container invocation entry points for parity workflow
      - path: tests/README.md
        provides: Contributor-facing parity artifact and triage guidance
    key_links:
      - from: tests/run_tests.sh
        to: tests/fixtures/manifest.yaml
        via: Representative fixture selection drives deterministic parity scope
        pattern: ci_representative
      - from: tests/run_tests.sh
        to: docker-compose.yml
        via: Parity mode invokes containerized verification path and compares outcomes
        pattern: docker
      - from: docs/BUILD.md
        to: tests/run_tests.sh
        via: Build documentation points to exact reproducibility parity command
        pattern: parity
---

<objective>
Implement a deterministic host-vs-Docker reproducibility parity harness for required verification outcomes.

Purpose: satisfy REL-01 with reproducibility evidence that is stable and actionable.
Output: parity-capable runner flow, deterministic artifacts, and operator guidance.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/05-reproducible-release-gate/05-CONTEXT.md
@.planning/phases/05-reproducible-release-gate/05-RESEARCH.md
@tests/run_tests.sh
@tests/fixtures/manifest.yaml
@Dockerfile
@docker-compose.yml
@docs/BUILD.md
@tests/README.md

Locked decisions to honor:
- Reproducibility is required verification outcome parity, not byte-identical artifacts.
- Fixture scope uses deterministic manifest representatives (`ci_representative: true`).
- Required parity mismatches are hard failures for release-gate paths.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deterministic host-vs-Docker parity mode to test runner</name>
  <files>tests/run_tests.sh</files>
  <action>Extend the test runner with a parity mode that executes required verification checks in host and Docker paths over representative fixtures, compares outcome summaries by architecture/check group, and exits non-zero on any required mismatch.</action>
  <verify><automated>bash tests/run_tests.sh --mode verify-parity --arch all --artifacts-dir ci-artifacts</automated></verify>
  <done>Runner produces deterministic parity comparison output and fails closed on required verification outcome mismatches.</done>
</task>

<task type="auto">
  <name>Task 2: Align Docker execution surface with parity harness requirements</name>
  <files>Dockerfile
docker-compose.yml</files>
  <action>Adjust container build/run definitions so the parity mode can execute verification commands reproducibly in Docker with the same fixture and script inputs expected by host mode.</action>
  <verify><automated>docker compose run --rm verify python3 verify_denulled.py --help</automated></verify>
  <done>Docker execution path required by parity mode is stable and callable from repository scripts without manual container tweaking.</done>
</task>

<task type="auto">
  <name>Task 3: Document parity command path and artifact triage contract</name>
  <files>docs/BUILD.md
tests/README.md</files>
  <action>Document the canonical parity command, artifact naming, mismatch triage order, and expected pass/fail behavior so maintainers can reproduce CI parity outcomes locally.</action>
  <verify><automated>rg -n "verify-parity|host-vs-docker|parity|ci_representative" docs/BUILD.md tests/README.md</automated></verify>
  <done>Docs define one canonical reproducibility parity path and make mismatch diagnosis deterministic.</done>
</task>

</tasks>

<verification>
Validate that host and Docker required verification outcomes match for representative fixtures across x86/x64/arm and that mismatches are clearly surfaced with deterministic artifact references.
</verification>

<success_criteria>
- Host-vs-Docker parity mode exists and is deterministic
- Required verification outcome mismatches are hard failures
- Representative fixture scope is enforced via manifest metadata
- Contributor docs explain parity invocation and mismatch triage
</success_criteria>

<output>
After completion, create `.planning/phases/05-reproducible-release-gate/05-01-SUMMARY.md`
</output>
