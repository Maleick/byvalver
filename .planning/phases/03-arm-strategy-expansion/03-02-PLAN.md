---
phase: 03-arm-strategy-expansion
plan: "02"
type: execute
wave: 2
depends_on:
  - "01"
files_modified:
  - src/arm_strategies.c
  - src/arm_immediate_encoding.c
  - src/arm_immediate_encoding.h
  - assets/tests/test_arm_strategies.c
  - tests/fixtures/manifest.yaml
autonomous: true
requirements:
  - ARM-02
must_haves:
    truths:
      - LDR/STR displacement rewrites preserve effective address behavior for covered forms.
      - Displacement rewrite logic is bounded to explicit supported addressing patterns.
      - Deterministic ARM fixtures verify load/store displacement rewrites and failures.
    artifacts:
      - path: src/arm_strategies.c
        provides: ARM LDR/STR displacement rewrite strategy gating and generation
      - path: src/arm_immediate_encoding.c
        provides: Shared helpers for displacement rewrite candidate validation
      - path: assets/tests/test_arm_strategies.c
        provides: ARM displacement strategy regression coverage
    key_links:
      - from: src/arm_strategies.c
        to: src/arm_immediate_encoding.c
        via: Memory rewrite strategies use helper APIs for displacement candidate checks
        pattern: ldr
      - from: assets/tests/test_arm_strategies.c
        to: src/arm_strategies.c
        via: Regression tests assert displacement rewrite behavior for LDR/STR
        pattern: LDR/STR
      - from: tests/fixtures/manifest.yaml
        to: tests/run_tests.sh
        via: ARM displacement fixture metadata is consumed by deterministic verification selection
        pattern: rep-arm
---

<objective>
Implement ARM LDR/STR displacement rewrite paths that preserve addressing behavior for covered forms and provide deterministic regression evidence.

Purpose: satisfy ARM-02 by enabling safe displacement rewrites instead of pass-through-only behavior.
Output: bounded displacement rewrite strategies, test coverage, and fixture metadata.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-arm-strategy-expansion/03-CONTEXT.md
@.planning/phases/03-arm-strategy-expansion/03-RESEARCH.md
@.planning/phases/03-arm-strategy-expansion/03-01-PLAN.md
@src/arm_strategies.c
@src/arm_immediate_encoding.c
@src/arm_immediate_encoding.h
@assets/tests/test_arm_strategies.c
@tests/fixtures/manifest.yaml

Plan dependency:
- Reuse helper patterns established in 03-01.
- Keep addressing-mode scope explicit and conservative.
- Add deterministic ARM displacement fixtures for regression.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bounded displacement rewrite helper coverage for memory operands</name>
  <files>src/arm_immediate_encoding.c
src/arm_immediate_encoding.h</files>
  <action>Add helper support to validate and construct safe displacement rewrite candidates for covered immediate-offset memory operand forms used by LDR/STR strategies.</action>
  <verify><automated>rg -n "ldr|str|displacement|offset|memory|arm" src/arm_immediate_encoding.c src/arm_immediate_encoding.h</automated></verify>
  <done>Displacement candidate logic is available for bounded LDR/STR rewrite paths.</done>
</task>

<task type="auto">
  <name>Task 2: Implement LDR/STR displacement rewrite strategies with explicit supported-pattern contracts</name>
  <files>src/arm_strategies.c</files>
  <action>Implement and register LDR/STR displacement rewrite strategies for explicit covered addressing forms. Preserve effective address/read-write semantics and decline unsupported forms deterministically.</action>
  <verify><automated>rg -n "arm_ldr|arm_str|displacement|offset|can_handle|register_arm_memory_strategies" src/arm_strategies.c</automated></verify>
  <done>LDR/STR displacement rewrites are available for covered forms and safely skipped for unsupported patterns.</done>
</task>

<task type="auto">
  <name>Task 3: Add deterministic displacement regression fixtures and focused tests</name>
  <files>assets/tests/test_arm_strategies.c
tests/fixtures/manifest.yaml</files>
  <action>Add deterministic ARM displacement fixtures and extend ARM strategy regression tests to assert addressing-preservation behavior for rewritten LDR/STR cases.</action>
  <verify><automated>rg -n "ldr|str|displacement|fixture_id|arm" tests/fixtures/manifest.yaml assets/tests/test_arm_strategies.c</automated></verify>
  <done>Displacement rewrite coverage is represented in deterministic fixture metadata and strategy-level regressions.</done>
</task>

</tasks>

<verification>
Validate that covered LDR/STR displacement rewrites preserve effective address behavior and remain deterministic across ARM verification fixtures.
</verification>

<success_criteria>
- Bounded displacement helper logic exists for covered memory forms
- LDR/STR rewrite strategies preserve addressing behavior for supported cases
- Unsupported forms decline rewrite safely and predictably
- Deterministic displacement fixtures and regressions demonstrate ARM-02 coverage
</success_criteria>

<output>
After completion, create `.planning/phases/03-arm-strategy-expansion/03-02-SUMMARY.md`
</output>
